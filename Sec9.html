<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Sección 9. Cómo desplegar aplicaciones con archivos yaml</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_sección_9_cómo_desplegar_aplicaciones_con_archivos_yaml">Sección 9. Cómo desplegar aplicaciones con archivos yaml</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En este capítulo el objetivo principal es desplegar aplicaciones
sencillas de las siguientes maneras:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utilizando comandos de kubectl</p>
</li>
<li>
<p>Exportando los recursos de kubernetes a archivos yaml</p>
</li>
<li>
<p>Reimportando los recursos desde los archivos yaml</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A partir de este capítulo estaremos trabajando más con archivos YAML</p>
</div>
<div class="paragraph">
<p>La sintaxis de YAML puede parecer complicada de manejar al principio, ya que requiere la utilización de espacios en lugar de tabulaciones (tabs), y además se debe mantener un nivel de indentación o sangría correctas para evitar errores de sintaxis.</p>
</div>
<div class="paragraph">
<p>Por esta razón se recomienda aplicar la siguiente configuración al archivo ~/.vimrc para que la edición de archivos YAML con este editor de textos sea más conveniente y sencilla.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">echo "set ai et bg=dark number cuc cul ts=2 sts=2 sw=2" &gt;&gt; ~/.vimrc</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_la_línea_de_comandos_kubectl">La línea de comandos Kubectl</h3>
<div class="paragraph">
<p>El comando kubectl, sirve como mecanismo para hablar con la API REST de Kubernetes, convirtiendo los comandos utilizados a llamadas HTTP para generar los recursos apropiados.</p>
</div>
<div class="paragraph">
<p>La línea de comandos, es útil en los siguientes casos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuando trabajamos directamente desde código fuente de la aplicación</p>
</li>
<li>
<p>Cuando se necesitan automatizar tareas administrativas repetitivas respecto al clúster de kubernetes.</p>
</li>
<li>
<p>Cuando no se tiene acceso a la administración a través de una interfaz gráfica como OpenLens o la consola web de Kubernetes, como el proyecto <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noopener">Kubernetes Dashboard</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Si no se especifica de otra manera, todos los comandos deben ejecutarse con usuario <code>root</code> desde el servidor <code>m1</code> o en el <code>standalone</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_generando_los_recursos_de_kubernetes">Generando los recursos de Kubernetes</h3>
<div class="paragraph">
<p>La API de Kubernetes maneja el concepto abstracto de recursos, para hacer referencia a cualquier tipo de objeto que puede ser administrado a través de la misma.</p>
</div>
<div class="paragraph">
<p>Estos recursos pueden ser nativos de kubernetes, o pueden ser añadidos o extendidos a través de la API de extensión llamada <em>CustomResourceDefinitions (Definiciones de recursos personalizados)</em>.</p>
</div>
<div class="paragraph">
<p>Los principales tipos de recursos con los que estaremos trabajando en este capítulo incluyen:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pods</p>
</li>
<li>
<p>Namespaces</p>
</li>
<li>
<p>Deployments</p>
</li>
<li>
<p>Services</p>
</li>
<li>
<p>Ingresses</p>
</li>
<li>
<p>ConfigMaps</p>
</li>
<li>
<p>Secrets</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_pods">Pods</h4>
<div class="paragraph">
<p>La unidad mínima de despliegue de un contenedor en Kubernetes es el <code>Pod</code>, el cual es un recurso que permite definir entre otras cosas, la imagen de uno o más contenedores que deben ser desplegados como una sola unidad, compartiendo recursos de red (direcciones IP) y almacenamiento, así como definir variables de entorno, volúmenes, puntos de montaje, límites de recursos de hardware como CPU o memoria RAM, entre otras informaciones.</p>
</div>
<div class="paragraph">
<p>Para crear un pod simple de forma imperativa, se puede utilizar el siguiente comando.</p>
</div>
<div class="listingblock">
<div class="title">Desde m1</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run web-server --image quay.io/openshift-scale/nginx
kubectl get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl run web-server --image quay.io/openshift-scale/nginx
pod/web-server created
[root@m1 ~]# kubectl get pods
NAME         READY   STATUS    RESTARTS   AGE
web-server   1/1     Running   0          28s
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Lo que hicimos en este caso fue desplegar un pod, de un solo contenedor, a partir de la imagen <code>quay.io/openshift-scale/nginx</code></p>
</div>
<div class="quoteblock">
<div class="title">Concepto de Imagen de Contenedor</div>
<blockquote>
La imagen de contenedor es un artefacto binario basado en un sistema operativo base, que cuenta con todas las dependencias y librerías para el correcto funcionamiento de la aplicación. La misma se descarga desde un repositorio especializado llamado "Registry" o registro de imágenes.
</blockquote>
</div>
<div class="paragraph">
<p>También podríamos crear un pod y ejecutar un comando de forma interactiva, por ejemplo abrir una terminal para examinar el contenido de los comandos y archivos de la imagen utilizada.</p>
</div>
<div class="listingblock">
<div class="title">Desde m1</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run -it test-containers \
--image registry.access.redhat.com/ubi9/ubi \
--command -- /bin/bash</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dentro del contenedor</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat /etc/redhat-release
exit</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl run -it test-containers \
--image registry.access.redhat.com/ubi9/ubi \
--command -- /bin/bash
If you don't see a command prompt, try pressing enter.
[root@test-containers /]# cat /etc/redhat-release
Red Hat Enterprise Linux release 9.3 (Plow)
[root@test-containers /]# exit
exit
Session ended, resume using 'kubectl attach test-containers -c test-containers -i -t' command when the pod is running
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Por defecto los pods utilizan la política de reinicio llamada <code>Always</code>, la cual estaría tratando de reiniciar constantemente los pods en caso de fallas o apagado del aplicativo corriendo dentro del mismo. Otras políticas disponibles son <code>OnFailure</code> (solo en caso de fallas) y <code>Never</code> (no reinicia nunca). Estas políticas pueden aplicarse al pod con el parámetro <code>--restart</code> del comando <code>kubectl run</code></p>
</div>
<div class="listingblock">
<div class="title">Eliminar recursos generados</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete pod test-containers
kubectl delete pod web-server
kubectl get pods</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Los recursos pueden tardar hasta un minuto o más en eliminarse por completo
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_namespaces">Namespaces</h4>
<div class="paragraph">
<p>Los namespaces o "espacios de nombre" de kubernetes permiten la segmentación lógica de los recursos generados.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/Namespaces.png" alt="Namespaces"></span></p>
</div>
<div class="paragraph">
<p>En el apartado anterior, todos los recursos generados fueron desplegados en el namespace <code>default</code>, el cual siempre está presente en cualquier distribución de kubernetes</p>
</div>
<div class="paragraph">
<p>Nosotros podríamos generar nuevos namespaces de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="title">Desde el servidor m1</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create namespace pruebas2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create namespace pruebas2
namespace/pruebas2 created
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Cuando creamos un nuevo namespace, debemos agregar el parámetro <code>--namespace</code> o <code>-n</code> a los comandos de <code>kubectl</code> para indicar el namespace sobre el cual queremos trabajar. Por ejemplo, si queremos desplegar la aplicación anterior pero en el nuevo namespace generado utilizaríamos el siguiente comando:</p>
</div>
<div class="listingblock">
<div class="title">Desde el servidor m1</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run web-server --image quay.io/openshift-scale/nginx -n pruebas2
kubectl get pods -n pruebas2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl run web-server --image quay.io/openshift-scale/nginx -n pruebas2
pod/web-server created
[root@m1 ~]# kubectl get pods -n pruebas2
NAME         READY   STATUS    RESTARTS   AGE
web-server   1/1     Running   0          28s
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Por otro lado, si quisiéramos obtener la lista completa de pods de todo el clúster, podriamos utilizar el parámetro <code>--all-namespaces</code></p>
</div>
<div class="listingblock">
<div class="title">Desde el servidor m1</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get pods --all-namespaces</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl get pods --all-namespaces
NAMESPACE     NAME                                               READY   STATUS      RESTARTS       AGE
default       test-containers                                    1/1     Running     1 (11m ago)    12m
default       web-server                                         1/1     Running     0              17h
kube-system   coredns-77ccd57875-x5dwq                           1/1     Running     6 (46h ago)    43d
kube-system   helm-install-traefik-5x4b6                         0/1     Completed   1              43d
kube-system   helm-install-traefik-crd-pqphf                     0/1     Completed   0              43d
kube-system   local-path-provisioner-957fdf8bc-rwclw             1/1     Running     11 (46h ago)   43d
kube-system   metrics-server-648b5df564-4ggz5                    1/1     Running     10 (46h ago)   43d
kube-system   svclb-traefik-49d4b1f6-49h7c                       2/2     Running     12 (46h ago)   43d
kube-system   svclb-traefik-49d4b1f6-lzzvc                       2/2     Running     12 (46h ago)   43d
kube-system   svclb-traefik-49d4b1f6-mz4rc                       2/2     Running     12 (46h ago)   43d
kube-system   svclb-traefik-49d4b1f6-mzwmz                       2/2     Running     12 (46h ago)   43d
kube-system   svclb-traefik-49d4b1f6-rzcww                       2/2     Running     12 (46h ago)   43d
kube-system   traefik-64f55bb67d-wxcc8                           1/1     Running     6 (46h ago)    43d
pruebas2      web-server                                        1/1     Running     0              86s
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Para definir un namespace por defecto que sea diferente al <code>default</code>, se puede ejecutar el siguiente comando</p>
</div>
<div class="listingblock">
<div class="title">Desde m1</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl config set-context --current --namespace=pruebas2
kubectl get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl config set-context --current --namespace=pruebas2
Context "default" modified.
[root@m1 ~]# kubectl get pods
NAME         READY   STATUS    RESTARTS   AGE
web-server   1/1     Running   0          2m14s
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Una vez ejecutado este comando, los demás comandos de kubectl se ejecutarán en el namespace que hayamos escogido sin la necesidad de agregar el parámetro <code>--namespace</code> o <code>-n</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_deployments">Deployments</h4>
<div class="paragraph">
<p>Los deployments nos permiten controlar la cantidad de réplicas o instancias para una aplicación, y cada réplica estar dispersada en diferentes zonas de disponibilidad, por ejemplo en diferentes nodos worker o diferentes datacenters, mediante políticas de afinidad y anti-afinidad que podemos definir para modificar el comportamiento del <em>Scheduler</em> de Kubernetes</p>
</div>
<div class="paragraph">
<p>Para desplegar la misma aplicación que en el apartado anterior podríamos ejecutar el siguiente comando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create deployment web-server --image=quay.io/openshift-scale/nginx
kubectl get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create deployment web-server --image=quay.io/openshift-scale/nginx
deployment.apps/web-server created
[root@m1 ~]# kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
web-server                    1/1     Running   0          21m
web-server-64d9989448-4mxdx   1/1     Running   0          2m48s
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Los <code>Deployments</code> forman la base fundacional para desplegar aplicaciones en Kubernetes, los mismos consumen un <code>PodTemplate</code> a partir del cual crear recursos llamados <code>ReplicaSets</code>, y estos a su vez crear las instancias de <code>Pod</code> necesarias para satisfacer los requerimientos declarados.</p>
</div>
<div class="paragraph">
<p>Para extender la cantidad de réplicas de la aplicación anterior, podríamos ejecutar el siguiente comando, especificando la cantidad de réplicas deseadas con el parámetro <code>--replicas</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl scale deployment/web-server --replicas=3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl scale --replicas=3 deployment/web-server
deployment.apps/web-server scaled
[root@m1 ~]# kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
web-server                    1/1     Running   0          16h
web-server-64d9989448-4mxdx   1/1     Running   0          15h
web-server-64d9989448-jst7d   1/1     Running   0          4h42m
web-server-64d9989448-q92xh   1/1     Running   0          4h42m
[root@m1 ~]#</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_services">Services</h4>
<div class="paragraph">
<p>Los servicios de kubernetes nos permiten balancear la carga entre los distintos pods de aplicaciones que hemos desplegado con los Deployment.</p>
</div>
<div class="paragraph">
<p>El tipo de balanceo realizado es de capa 4, es decir, a nivel de protocolos TCP o UDP, utilizando reglas nativas de IPTables o NFTables del kernel de Linux.</p>
</div>
<div class="paragraph">
<p>Existen diferentes tipos de Services en Kubernetes, entre ellos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ClusterIP</strong>: utilizado para balanceo interno, es el más utilizado generalmente.</p>
</li>
<li>
<p><strong>LoadBalancer</strong>: utilizado para acceso externo al cluster, depende de la integración nativa con el proveedor de infraestructura</p>
</li>
<li>
<p><strong>NodePort</strong>: Utilizado para acceso externo, habilita un puerto en cada nodo master o worker del clúster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El balanceo se realiza utilizando el concepto de <em>etiquetas</em> o <em>labels</em>, los cuales son metadatos que pueden ser añadidos a cualquier tipo de recurso, en este caso a los <code>Pods</code>.</p>
</div>
<div class="paragraph">
<p>Cuando ejecutamos el comando <code>kubectl create deployment</code> el mismo genera la etiqueta <code>app</code> con un valor igual al nombre del deployment que pasamos como parámetro. En el ejemplo anterior, este sería <code>app: web-server</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/Services.png" alt="Services">
</div>
</div>
<div class="paragraph">
<p>Con el siguiente comando, podríamos indicar a Kubernetes que nos genere un recurso de tipo Service para el deployment <code>web-server</code>, apuntando al puerto 8080, el cual es el puerto abierto por el contenedor para tráfico HTTP</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl expose deployment/web-server --port=8080</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl expose deployment/web-server --port=8080
service/web-server exposed
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Para visualizar el servicio creado</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get services</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl get services
NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE
web-server   ClusterIP   10.43.78.42   &lt;none&gt;        8080/TCP   52s
[root@m1 ~]#</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ingresses">Ingresses</h4>
<div class="paragraph">
<p>Los ingresses de Kubernetes controlan las reglas de acceso a las aplicaciones internas del clúster, se pueden controlar tanto el nombre de Host o DNS con el que entra la petición, y los contextos o rutas de acceso a los pods, así como los aplicativos que son expuestos al mundo exterior. No hace falta que todos los aplicativos tengan un Ingress asociado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/Ingress.png" alt="Ingress">
</div>
</div>
<div class="paragraph">
<p>Para exponer la aplicación anterior, podríamos utilizar el siguiente comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create ingress web-server --rule=web-server-prueba2.chi1116.example.com/*=web-server:8080</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create ingress web-server --rule=web-server-prueba2.chi1217.example.com/*=web-server:8080
ingress.networking.k8s.io/web-server created
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Podemos utilizar cualquier valor de DNS en el parámetro <code>--rule</code>, en este caso, estaremos haciendo uso extensivo de nuestro dominio comodín de aplicaciones *.chi1116.example.com que apuntamos a nuestro balanceador de carga HAProxy.</p>
</div>
<div class="paragraph">
<p>Este dominio nos permite ahorrarnos el trabajo de tener que registrar un nuevo DNS por cada ruta nueva que querramos agregar, y nos permite agregar reglas que tengan como contexto <code>/*</code> lo cual implica que la aplicación no necesita preocuparse por redireccionamientos de contexto o re-escrituras de URL.</p>
</div>
<div class="paragraph">
<p>En este caso utilizamos la siguiente estandarización para los nombres de DNS: <code>&lt;nombre_ingress&gt;-&lt;namespace&gt;.apps.k8s.&lt;base_domain&gt;</code>, donde:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>&lt;nombre_ingress&gt;</code> es el nombre del recurso Ingress creado para esta aplicación</p>
</li>
<li>
<p><code>&lt;namespace&gt;</code> es el espacio de nombres donde reside la aplicación</p>
</li>
<li>
<p><code>&lt;base_domain&gt;</code> es el dominio base de la instalación de kubernetes utilizada.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Revisemos el ingress creado</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get ingresses</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl get ingresses
NAME         CLASS     HOSTS                                      ADDRESS                                                                 PORTS   AGE
web-server   traefik   web-server-prueba2.chi1217.example.com   192.168.16.51,192.168.16.52,192.168.16.53,192.168.16.54,192.168.16.55   80      43s
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Probemos el acceso a la URL generada anteriormente con curl</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl http://web-server-prueba2.chi1116.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# curl http://web-server-prueba2.chi1217.example.com
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome 0128B&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome 0128B&lt;/h1&gt;

&lt;pre&gt;
&lt;/pre&gt;

&lt;/body&gt;
&lt;/html&gt;
[root@m1 ~]#</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configmaps">ConfigMaps</h4>
<div class="paragraph">
<p>Las aplicaciones por lo general, por una cuestión de buenas prácticas de desarrollo para la nube, no contienen toda la configuración necesaria para ejecutarse correctamente embebidas en el código fuente de las mismas, sino que requieren externalizar su configuración de alguna manera, por ejemplo a través del asignamiento de variables de entorno o archivos de configuración que apunten a las IPs, URLs, APIs, Credenciales u otros tipos de informaciones, correctamente, de acuerdo al entorno en donde se ejecute.</p>
</div>
<div class="paragraph">
<p>Para el ejemplo anterior, nosotros podríamos ejecutar el siguiente comando para agregar variables de entorno a nuestro deployment, más allá de que esta aplicación en particular por su naturaleza sencilla, no requiera variables o configuraciones especiales para funcionar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server MYVAR=MYVALUE</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server MYVAR=MYVALUE
deployment.apps/web-server env updated
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Podremos despues revisar esta configuración con el parámetro <code>--list</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server --list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server --list
# Deployment web-server, container nginx
MYVAR=MYVALUE
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>También podríamos ejecutar un comando dentro del contenedor para verificar el valor de una variable de entorno</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl exec -ti deployment/web-server -- printenv MYVAR</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl exec -ti deployment/web-server -- printenv MYVAR
MYVALUE
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>A medida que vayamos agregando más variables de entorno o más aplicaciones requieran de las mismas variables, conviene ir centralizando las mismas a través del uso de los recursos de tipo ConfigMap</p>
</div>
<div class="quoteblock">
<div class="title">Concepto de ConfigMap</div>
<blockquote>
Un ConfigMap es un mapa de configuración con pares del tipo CLAVE: valor, donde dichas claves y valores pueden ser compleamente arbitrarios, o contener cualquier valor. El ConfigMap puede inyectarse dentro de la aplicación de dos maneras: como variable de entorno o como archivo de configuración
</blockquote>
</div>
<div class="paragraph">
<p>Podemos crear un ConfigMap para albergar configuraciones del estilo variables de entorno de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create configmap myenv --from-literal MYVAR1=value1 --from-literal MYVAR2=value2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create configmap myenv --from-literal MYVAR1=value1 --from-literal MYVAR2=value2
configmap/myenv created
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Se puede utilizar varias veces el parámetro <code>--from-literal</code> para pasar más de una variable de entorno</p>
</div>
<div class="paragraph">
<p>Una vez generado el configmap, podemos asignar las variables de entorno del mismo a un deployment de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server --from=configmap/myenv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server --from=configmap/myenv
deployment.apps/web-server env updated
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Revisamos cómo quedan las variables en la aplicación</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server --list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server --list
# Deployment web-server, container nginx
MYVAR=MYVALUE
# MYVAR1 from configmap myenv, key MYVAR1
# MYVAR2 from configmap myenv, key MYVAR2
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Para listas más largas de variables de entorno podríamos crear un archivo para guardar las mismas, de la siguiente manera, separando las claves y valores con el signo <code>=</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF &gt; .env
MYVAR1=value1
MYVAR2=value2
MYVAR3=value3
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Luego asignar las variables a partir del archivo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat .env | kubectl set env deployment/web-server -e -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# cat .env | kubectl set env deployment/web-server -e -
deployment.apps/web-server env updated
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Revisemos el resultado</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server --list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server --list
# Deployment web-server, container nginx
MYVAR=MYVALUE
MYVAR1=value1
MYVAR2=value2
MYVAR3=value3
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Otra manera de trabajar con recursos de tipo <code>ConfigMap</code> es a través de archivos de configuración en lugar de variables de entorno. Por ejemplo podríamos definir un archivo <code>application.properties</code> que la aplicación espera que esté presente en el directorio <code>/etc/config</code> del contenedor, de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF &gt; application.properties
database-url=jdbc:mysql://localhost:3306/mydb
database-user=appuser
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez definido el archivo, procedemos a crear un <code>ConfigMap</code> a partir del mismo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create configmap myfile --from-file=application.properties</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create configmap myfile --from-file=application.properties
configmap/myfile created
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Para aplicar este <code>ConfigMap</code> al aplicativo, debemos generar un volumen apuntando al punto de montaje solicitado por la aplicación, en este caso <code>/etc/config</code>, de tal manera que la ruta completa del archivo sería <code>/etc/config/application.properties</code></p>
</div>
<div class="paragraph">
<p>Veremos cómo generar este tipo de volumen más adelante cuando revisemos el método declarativo de creación de recursos de kubernetes.</p>
</div>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap" class="bare">https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap</a></p>
</div>
<div class="paragraph">
<p>Veamos cómo queda la definición del ConfiMap</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl describe configmap/myfile</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl describe configmap/myfile
Name:         myfile <b class="conum">(1)</b>
Namespace:    pruebas2 <b class="conum">(2)</b>
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
====
application.properties: <b class="conum">(3)</b>
-----
database-url=jdbc:mysql://localhost:3306/mydb
database-user=appuser


BinaryData
====

Events:  &lt;none&gt;
[root@m1 ~]#</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nombre del ConfigMap</p>
</li>
<li>
<p>Namespace al que pertenece el recurso</p>
</li>
<li>
<p>Datos contenidos en la clave application.properties</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_secrets">Secrets</h4>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/concepts/configuration/secret/" class="bare">https://kubernetes.io/docs/concepts/configuration/secret/</a></p>
</div>
<div class="paragraph">
<p>Para los casos donde los datos que debemos pasar a las aplicaciones sean sensibles, como los casos de passwords, tokens, certificados, claves SSH, etc., tenemos la opción de utilizar el recurso Secret de Kubernetes.</p>
</div>
<div class="paragraph">
<p>Los <code>Secrets</code> trabajan de manera muy similar a los <code>ConfigMap</code>, ya que tienen una estructura interna muy parecida. La única diferencia sería que los datos internamente, en la base de datos etcd, se guardan en formato codificado en base64, y tienen la opción de ser encriptados en frío, es decir, en la misma base de datos etcd. En algunas distribuciones de Kubernetes, también los <code>Secrets</code> pueden ser resguardados a través de los permisos basados en roles de los usuarios de la plataforma.</p>
</div>
<div class="paragraph">
<p>Por otro lado, existen distintos tipos de <code>Secrets</code> para los distintos casos de uso que podríamos necesitar. Vamos a listar algunos</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Opaque</strong>: permite la utilización de claves y valores arbitrarios</p>
</li>
<li>
<p><strong>kubernetes.io/ssh-auth</strong>: restringe la clave a <code>ssh-privatekey</code> y el valor a un archivo de clave privada ssh</p>
</li>
<li>
<p><strong>kubernetes.io/tls</strong>: restringe la clave a <code>tls.crt</code> y <code>tls.key</code> y los valores a los archivos respectivos de clave pública y clave privada TLS, respectivamente.</p>
</li>
<li>
<p><strong>kubernetes.io/dockerconfigjson</strong>: restringe la clave a <code>dockerconfigjson</code> y el valor sería un archivo <code>.docker/config.json</code> con las credenciales de acceso a Registries privadas de las cuales necesitamos descargar imágenes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>En esta sección nos vamos a concentrar en los <code>Secrets</code> de tipo <code>Opaque</code> o genéricos que nos dan total libertad sobre los datos que podemos guardar. Por esta razón son especiales para guardar datos de variables de entorno o archivos de configuración arbitrarios de aplicativos.</p>
</div>
<div class="paragraph">
<p>En secciones posteriores estaremos revisando otros tipos de <code>Secret</code> de acuerdo con el caso de uso relacionado.</p>
</div>
<div class="paragraph">
<p>Podemos crear un <code>Secret</code> para albergar configuraciones del estilo variables de entorno de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create secret generic mysecretenv --from-literal MYVAR4=value4 --from-literal MYVAR5=value5</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create configmap mysecretenv --from-literal MYVAR4=value4 --from-literal MYVAR4=value4
secret/mysecretenv created
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Se puede utilizar varias veces el parámetro <code>--from-literal</code> para pasar más de una variable de entorno</p>
</div>
<div class="paragraph">
<p>Una vez generado el <code>Secret</code>, podemos asignar las variables de entorno del mismo a un deployment de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server --from=secret/mysecretenv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server --from=secret/mysecretenv
deployment.apps/web-server env updated
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Revisamos cómo quedan las variables en la aplicación</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl set env deployment/web-server --list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl set env deployment/web-server --list
# Deployment web-server, container nginx
MYVAR=MYVALUE
MYVAR1=value1
MYVAR2=value2
MYVAR3=value3
# MYVAR4 from secret mysecretenv, key MYVAR4
# MYVAR5 from secret mysecretenv, key MYVAR5
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Otra manera de trabajar con recursos de tipo <code>Secret</code> es a través de archivos de configuración en lugar de variables de entorno. Por ejemplo podríamos definir un archivo <code>application.properties</code> que la aplicación espera que esté presente en el directorio <code>/etc/config</code> del contenedor, de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt;EOF &gt; application.properties
database-url=jdbc:mysql://localhost:3306/mydb
database-user=appuser
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez definido el archivo, procedemos a crear un <code>ConfigMap</code> a partir del mismo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create secret generic mysecretfile --from-file=application.properties</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl create secret generic mysecretfile --from-file=application.properties
secret/mysecretfile created
[root@m1 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Para aplicar este <code>Secret</code> al aplicativo, debemos generar un volumen apuntando al punto de montaje solicitado por la aplicación, en este caso <code>/etc/config</code>, de tal manera que la ruta completa del archivo sería <code>/etc/config/application.properties</code></p>
</div>
<div class="paragraph">
<p>Veremos cómo generar este tipo de volumen más adelante cuando revisemos el método declarativo de creación de recursos de kubernetes.</p>
</div>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/" class="bare">https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/</a></p>
</div>
<div class="paragraph">
<p>Veamos cómo queda la definición del secret</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl describe secret mysecretfile</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# kubectl describe secret mysecretfile
Name:         mysecretfile <b class="conum">(1)</b>
Namespace:    pruebas2 <b class="conum">(2)</b>
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque <b class="conum">(3)</b>

Data
====
application.properties:  68 bytes <b class="conum">(4)</b>
[root@m1 ~]#</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Nombre del secret</p>
</li>
<li>
<p>Namespace al que pertenece el recurso</p>
</li>
<li>
<p>Tipo de secret, en este caso <code>Opaque</code></p>
</li>
<li>
<p>Datos contenidos en la clave application.properties, al ser un <code>Secret</code> no se muestran los datos en pantalla</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generando_recursos_en_modelo_declarativo">Generando recursos en modelo declarativo</h3>
<div class="paragraph">
<div class="title">Modelo Imperativo vs. Modelo Declarativo</div>
<p>Hasta ahora hemos generado los recursos utilizando el modelo imperativo, es decir, ejecutando cada comando de kubectl necesario para generar los mismos.</p>
</div>
<div class="paragraph">
<p>El modelo de trabajo imperativo es el que generalmente estamos acostumbrados como Administradores de Sistemas, nos permite ejecutar el comando correcto en el momento oportuno, nos permite automatizar en la forma de scripts de shell que con el trabajo de scripting y programación adecuados nos permitiría desplegar aplicaciones completas.</p>
</div>
<div class="paragraph">
<p>Este modelo es interesante cuando estamos empezando a aprender cómo trabajar con kubernetes, ya que la sintaxis interna de cada recurso puede parecer bastante compleja, al menos al principio.</p>
</div>
<div class="paragraph">
<p>El modelo declarativo, por otro lado, permite trabajar de forma más directa con la sintaxis en código YAML o JSON del objeto o recurso en cuestión, definirlo como código y guardarlo como archivos, definiendo de esta manera nuestra Infraestructura como Código (<code>IaC</code>)</p>
</div>
<div class="paragraph">
<p>La principal ventaja de esto es que podemos más adelante versionar este código en un repositorio de Git, lo cual nos brinda trazabilidad, auditoría y seguridad, además de la posibilidad de volver atrás nuestros cambios cuando tenemos resultados no planificados.</p>
</div>
<div class="paragraph">
<p>En contrapartida, en el modelo declarativo debemos comprender la funcionalidad y atributos de cada tipo de recurso de Kubernetes con el que deseamos trabajar</p>
</div>
<div class="paragraph">
<p>El comando <code>kubectl</code> tiene algunas opciones para generar archivos yaml. Basta con que le agreguemos los parámetros <code>--dry-run=client</code> y <code>-o yaml</code> a los comandos imperativos de <code>kubectl create</code> o <code>kubectl run</code>. Con estos parámetros, el recurso no será generado en el clúster de Kubernetes, sino que su representación en formato YAML será desplegada en la terminal.</p>
</div>
<div class="paragraph">
<p>Veamos algunos ejemplos para cada tipo de recurso</p>
</div>
<div class="sect3">
<h4 id="_pods_2">Pods</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl run web-server --image quay.io/openshift-scale/nginx --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: v1 <b class="conum">(1)</b>
kind: Pod <b class="conum">(2)</b>
metadata: <b class="conum">(3)</b>
  creationTimestamp: null
  labels: <b class="conum">(4)</b>
    run: web-server
  name: web-server <b class="conum">(5)</b>
spec: <b class="conum">(6)</b>
  containers:
  - image: quay.io/openshift-scale/nginx <b class="conum">(7)</b>
    name: web-server <b class="conum">(8)</b>
    resources: {}
  dnsPolicy: ClusterFirst
  restartPolicy: Always <b class="conum">(9)</b>
status: {} <b class="conum">(10)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Versión de la API de Kubernetes, bajo la cual se encuentra el endpoint del recurso</p>
</li>
<li>
<p>Tipo de recurso, en este caso <code>Pod</code></p>
</li>
<li>
<p>Definición de metadatos del recurso</p>
</li>
<li>
<p>Definición de etiquetas (<code>labels</code>) asignadas al recurso, en la forma de <code>clave: valor</code></p>
</li>
<li>
<p>Nombre del recurso</p>
</li>
<li>
<p>Definición de la especficación (<code>spec</code>) del recurso</p>
</li>
<li>
<p>Imagen utilizada para el Pod</p>
</li>
<li>
<p>Nombre del contenedor dentro del Pod</p>
</li>
<li>
<p>Política de reinicio</p>
</li>
<li>
<p>Status del recurso, como esta definición es offline, entonces este campo se encuentra vacío</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_namespaces_2">Namespaces</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create namespace pruebas2 --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: v1
kind: Namespace <b class="conum">(1)</b>
metadata:
  creationTimestamp: null
  name: pruebas2 <b class="conum">(2)</b>
spec: {}
status: {}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Tipo de recurso Namespace</p>
</li>
<li>
<p>Nombre del namespace</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_deployments_2">Deployments</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create deployment web-server --image=quay.io/openshift-scale/nginx --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: apps/v1 <b class="conum">(1)</b>
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: web-server
  name: web-server
spec:
  replicas: 1 <b class="conum">(2)</b>
  selector: <b class="conum">(3)</b>
    matchLabels:
      app: web-server
  strategy: {}
  template: <b class="conum">(4)</b>
    metadata:
      creationTimestamp: null
      labels:
        app: web-server
    spec:
      containers:
      - image: quay.io/openshift-scale/nginx
        name: nginx
        resources: {}
status: {}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Aquí el apiVersion cambia a apps/v1 es decir es una extensión de la API Nativa v1 de Kubernetes.</p>
</li>
<li>
<p>El recurso de tipo <code>Deployment</code> permite especificar la cantidad de réplicas de aplicación, es decir la cantidad de instancias del recurso <code>Pod</code> que serán generadas a partir del <code>PodTemplate</code></p>
</li>
<li>
<p>El atributo <code>selector</code> debe coincidir con las etiquetas de los <code>Pods</code> generados por el recurso <code>Deployment</code></p>
</li>
<li>
<p>el atributo <code>template</code> define un objeto de tipo <code>PodTemplate</code>, que básicamente comparte todos los atributos que tendría un <code>Pod</code>, permitiendo de esta manera que todos los <code>Pods</code> generados a partir del mismo <code>Deployment</code> compartan exactamente los mismos atributos, definiciones de recursos de hardware, variables de entorno, imagen de contendor, etc.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_services_2">Services</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create service clusterip web-server --tcp=8080:8080 --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: web-server
  name: web-server
spec:
  ports: <b class="conum">(1)</b>
  - name: 8080-8080
    port: 8080
    protocol: TCP
    targetPort: 8080
  selector: <b class="conum">(2)</b>
    app: web-server
  type: ClusterIP <b class="conum">(3)</b>
status:
  loadBalancer: {}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Los servicios exponen un puerto en la IP del servicio (<code>port</code>) apuntando al puerto del contenedor (<code>targetPort</code>). En este caso tanto el puerto del servicio como del contenedor es <code>8080</code></p>
</li>
<li>
<p>Los servicios utilizan selectores de etiquetas que deben coincidir con los de los <code>Pods</code> que estarán siendo balanceados</p>
</li>
<li>
<p>Tipo de Servicio, en este caso <code>ClusterIP</code>, pero podríamos reemplazarlo por otro valor como <code>LoadBalancer</code> o <code>NodePort</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_ingresses_2">Ingresses</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create ingress web-server --rule=web-server-prueba2.chi1116.example.com/*=web-server:8080 --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  creationTimestamp: null
  name: web-server
spec:
  rules: <b class="conum">(1)</b>
  - host: web-server-prueba2.chi1116.example.com <b class="conum">(2)</b>
    http:
      paths:
      - backend:
          service:
            name: web-server <b class="conum">(3)</b>
            port:
              number: 8080 <b class="conum">(4)</b>
        path: /
        pathType: Prefix <b class="conum">(5)</b>
status:
  loadBalancer: {}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Definición de reglas de ingreso</p>
</li>
<li>
<p>Nombre DNS del Host con el cual se espera recibir las peticiones, en este caso apuntamos al balanceador de carga externo lb.s1.example.com</p>
</li>
<li>
<p>Nombre del servicio del cual se obtendrán los <code>Endpoints</code> (colecciones de IPs:Puertos) de los <code>Pods</code> que serán balanceados por el Ingress Controller.</p>
</li>
<li>
<p>Puerto en el que escucha el contenedor</p>
</li>
<li>
<p>El atributo <code>pathType</code> de tipo <code>Prefix</code> indica que todas las sub-URLs de la ruta <code>path</code> coinciden con la regla de ingreso. Otro tipo de <code>pathType</code> podría ser <code>Exact</code>, el cual indica que la ruta <code>path</code> se considera de forma literal o exacta para este backend en particular.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configmaps_2">ConfigMaps</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create configmap myfile --from-file=application.properties --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: v1
data: <b class="conum">(1)</b>
  application.properties: | <b class="conum">(2)</b>
    database-url=jdbc:mysql://localhost:3306/mydb
    database-user=appuser
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: myfile</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>el atributo <code>data</code> contiene las definiciones de las claves y valores para el <code>ConfigMap</code></p>
</li>
<li>
<p>Definición de un archivo como clave, la barra vertical (|) indica que los saltos de línea y espacios deben respetarse en el valor. El valor en este caso es el contenido del archivo</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_secrets_2">Secrets</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create secret generic mysecretfile --from-file=application.properties --dry-run=client -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: v1
data: <b class="conum">(1)</b>
  application.properties: ZGF0YWJhc2UtdXJsPWpkYmM6bXlzcWw6Ly9sb2NhbGhvc3Q6MzMwNi9teWRiCmRhdGFiYXNlLXVzZXI9YXBwdXNlcgo=
kind: Secret
metadata:
  creationTimestamp: null
  name: mysecretfile</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Los datos en este caso están codificados en base64</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Otra opción de definición de <code>Secret</code> como YAML podría ser la siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: v1
stringData: <b class="conum">(1)</b>
  application.properties: |
    database-url=jdbc:mysql://localhost:3306/mydb
    database-user=appuser
kind: Secret
metadata:
  creationTimestamp: null
  name: mysecretfile</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>En lugar de <code>data</code> se puede utilizar el atributo <code>stringData</code> para referenciar el valor en texto plano</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_generación_de_recursos_a_partir_de_los_archivos_yaml">Generación de recursos a partir de los archivos YAML</h4>
<div class="paragraph">
<p>Todos los recursos generados anteriormente pueden ser guardados como archivos YAML con extensión <code>.yml</code> o <code>.yaml</code> y luego pueden ser aplicados al clúster con el comando <code>kubectl apply -f ./</code>. Este comando leerá todos los archivos YAML del directorio actual y los aplicará al clúster/namespace que estén referenciados en los archivos, o el namespace seleccionado en el contexto actual de la configuración del KUBECONFIG.</p>
</div>
<div class="paragraph">
<p>Ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Generar todos los recursos</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mkdir web-server-app
cd web-server-app
kubectl create deployment web-server --image=quay.io/openshift-scale/nginx --dry-run=client -o yaml &gt; deployment.yaml
kubectl create service clusterip web-server --tcp=8080:8080 --dry-run=client -o yaml &gt; service.yaml
kubectl create ingress web-server --rule=web-server-prueba2.chi1116.example.com/*=web-server:8080 --dry-run=client -o yaml &gt; ingress.yaml
ls -l</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 ~]# mkdir web-server-app
[root@m1 ~]# cd web-server-app
[root@m1 web-server-app]# kubectl create deployment web-server --image=quay.io/openshift-scale/nginx --dry-run=client -o yaml &gt; deployment.yaml
[root@m1 web-server-app]# kubectl create service clusterip web-server --tcp=8080:8080 --dry-run=client -o yaml &gt; service.yaml
[root@m1 web-server-app]# kubectl create ingress web-server --rule=web-server-prueba2.chi1116.example.com/*=web-server:8080 --dry-run=client -o yaml &gt; ingress.yaml
[root@m1 web-server-app]# ls -l
total 12
-rw-r--r--. 1 root root 428 Dec 12 00:31 deployment.yaml
-rw-r--r--. 1 root root 369 Dec 12 00:31 ingress.yaml
-rw-r--r--. 1 root root 280 Dec 12 00:31 service.yaml
[root@m1 web-server-app]#</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Aplicar los recursos generado</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl apply -f ./</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 web-server-app]# kubectl apply -f ./
Warning: resource deployments/web-server is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically. <b class="conum">(1)</b>
deployment.apps/web-server configured
Warning: resource ingresses/web-server is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
ingress.networking.k8s.io/web-server configured
Warning: resource services/web-server is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
service/web-server configured
[root@m1 web-server-app]#</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Los warnings se deben a que los recursos que estamos modificando actualmente, fueron creados originalmente de forma imperativa, la siguiente vez que se ejecute el comando <code>kubectl apply -f ./</code> ya no aparecerán.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_documentación_acerca_de_los_atributos_de_recursos">Documentación acerca de los atributos de recursos</h4>
<div class="paragraph">
<p>Cuando empezamos a trabajar con los archivos YAML, rápidamente puede surgirnos la siguiente duda: ¿Cómo puedo aprenderme todos los atributos de todos los recursos posibles de Kubernetes?. La respuesta es: no hace falta.</p>
</div>
<div class="paragraph">
<p>El comando kubectl integra la documentación de cada uno de los recursos, con los parámetros y sus definiciones, haciendo referencia donde corresponda a la documentación oficial de Kubernetes para ese recurso.</p>
</div>
<div class="listingblock">
<div class="title">Documentación del recurso Pod</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl explain pod</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Documentación del atributo resources del Pod</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl explain pod.spec.containers.resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta documentación, en conjunto con los parámetros <code>--dry-run=client -o yaml</code> de los comandos de creación de kubernetes, nos pueden ahorrar tiempo en realizar búsquedas online.</p>
</div>
<div class="listingblock">
<div class="title">Conocer todos los tipos de recursos soportados por la API de Kubernetes</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl api-resources</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Conocer todas las versiones de api (APIVersions) soportadas por el clúster</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl api-versions</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cómo_exportar_recursos_generados_de_forma_imperativa">Cómo exportar recursos generados de forma imperativa</h3>
<div class="paragraph">
<p>A modo de salvaguardar nuestro trabajo en un clúster de kubernetes, una forma que tenemos de realizar una copia de seguridad de los recursos generados, es exportarlos a su correspondiente notación declarativa en la forma de archivos YAML o JSON</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get deployment/web-server -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "5"
  creationTimestamp: "2023-12-10T23:07:07Z"
  generation: 7
  labels:
    app: web-server
  name: web-server
  namespace: pruebas2
  resourceVersion: "217183"
  uid: 9de1a6ed-448e-4bfe-bb87-514a9419fde0
spec:
  progressDeadlineSeconds: 600
  replicas: 3
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: web-server
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: web-server
    spec:
      containers:
      - env:
        - name: MYVAR
          value: MYVALUE
        - name: MYVAR1
          value: value1
        - name: MYVAR2
          value: value2
        - name: MYVAR3
          value: value3
        - name: MYVAR4
          valueFrom:
            secretKeyRef:
              key: MYVAR4
              name: mysecretenv
        - name: MYVAR5
          valueFrom:
            secretKeyRef:
              key: MYVAR5
              name: mysecretenv
        image: quay.io/openshift-scale/nginx
        imagePullPolicy: Always
        name: nginx
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  availableReplicas: 3
  conditions:
  - lastTransitionTime: "2023-12-11T10:22:34Z"
    lastUpdateTime: "2023-12-11T10:22:34Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2023-12-10T23:07:07Z"
    lastUpdateTime: "2023-12-12T01:13:17Z"
    message: ReplicaSet "web-server-79c487966f" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  observedGeneration: 7
  readyReplicas: 3
  replicas: 3
  updatedReplicas: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para poder regenerar este recurso en otro namespace del mismo clúster, o en otro clúster completamente distinto, deberíamos eliminar las referencias únicas del recurso y dejarlo lo más "limpio" posible, es decir, con la cantidad mínima de atributos que necesitamos modificar. Por ejemplo podríamos re-escribir el YAML anterior de esta manera:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: web-server
  name: web-server
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web-server
  strategy:
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: web-server
    spec:
      containers:
      - env:
        - name: MYVAR
          value: MYVALUE
        - name: MYVAR1
          value: value1
        - name: MYVAR2
          value: value2
        - name: MYVAR3
          value: value3
        - name: MYVAR4
          valueFrom:
            secretKeyRef:
              key: MYVAR4
              name: mysecretenv
        - name: MYVAR5
          valueFrom:
            secretKeyRef:
              key: MYVAR5
              name: mysecretenv
        image: quay.io/openshift-scale/nginx
        imagePullPolicy: Always
        name: nginx
        resources: {}
      dnsPolicy: ClusterFirst
      restartPolicy: Always</code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta manera, se eliminaron los siguientes atributos innecesarios o con valores por defecto:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>.metadata</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>.annotations</p>
</li>
<li>
<p>.creationTimestamp</p>
</li>
<li>
<p>.generation</p>
</li>
<li>
<p>.namespace</p>
</li>
<li>
<p>.resourceVersion</p>
</li>
<li>
<p>.uid</p>
</li>
</ol>
</div>
</li>
<li>
<p>.spec</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>.progressDeadlineSeconds</p>
</li>
<li>
<p>.revisionHistoryLimit</p>
</li>
<li>
<p>.strategy.rollingUpdate</p>
</li>
<li>
<p>.containers[*].terminationMessagePath</p>
</li>
<li>
<p>.containers[*].terminationMessagePolicy</p>
</li>
</ol>
</div>
</li>
<li>
<p>.status</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_limpieza_del_ambiente">Limpieza del ambiente</h3>
<div class="paragraph">
<p>Para ahorrar recursos para los siguientes ejercicios, se procede a eliminar el namespace generado para este capítulo y modificar el contexto del <code>KUBECONFIG</code> al namespace por defecto <code>default</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd
kubectl config set-context --current --namespace default
kubectl get namespaces
kubectl delete namespace pruebas2
kubectl get namespaces</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Resultado esperado</div>
<div class="content">
<pre>[root@m1 web-server-app]# cd
[root@m1 ~]# kubectl config set-context --current --namespace default
Context "default" modified.
[root@m1 ~]# kubectl get namespaces
NAME              STATUS   AGE
default           Active   38h
kube-node-lease   Active   38h
kube-public       Active   38h
kube-system       Active   38h
pruebas2          Active   28h
[root@m1 ~]# kubectl delete namespace pruebas2
namespace "pruebas2" deleted
[root@m1 ~]# kubectl get namespaces
NAME              STATUS   AGE
default           Active   38h
kube-node-lease   Active   38h
kube-public       Active   38h
kube-system       Active   38h
[root@m1 ~]#</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-08-29 13:15:54 UTC
</div>
</div>
</body>
</html>